name: Deploy Website to Server (SUDO POWERED)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä½ çš„ç½‘ç«™ä»£ç 
      - name: Checkout Code
        uses: actions/checkout@v4

      # æ­¥éª¤ 2: é€šè¿‡ SSH Action éƒ¨ç½²æ–‡ä»¶
      - name: Deploy Files via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }} # åº”è¯¥æ˜¯ deployer
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            # å®šä¹‰çœŸå®çš„ç½‘ç«™æ ¹ç›®å½•
            TARGET_DIR="/var/www/mywebsite"
            
            # --- ä»¥ä¸‹æ˜¯åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„å‘½ä»¤ ---
            echo "ğŸš€ Starting deployment as user: $(whoami) on server: $(hostname)"
            echo "Deployment target directory is set to: ${TARGET_DIR}"
            
            # è¿›å…¥ç›®æ ‡ç›®å½•
            cd $TARGET_DIR || exit 1
            echo "Changed directory to: $(pwd)"
            
            # ä½¿ç”¨ sudo æ¥æ¸…ç©ºæ—§æ–‡ä»¶
            echo "ğŸ§¹ Cleaning up old files with sudo..."
            sudo find . -mindepth 1 -delete
            
            echo "âœ… Cleanup successful. Ready for sync."
