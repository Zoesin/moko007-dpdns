name: Deploy Website to GCP

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Deploy to GCP Server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.SSH_HOST }}
        username: ${{ secrets.SSH_USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          # å®šä¹‰æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™æ ¹ç›®å½•
          TARGET_DIR="/var/www/html"
          
          # ç¡®ä¿ç›®æ ‡ç›®å½•å­˜åœ¨
          sudo mkdir -p $TARGET_DIR
          
          # è¿›å…¥ç›®æ ‡ç›®å½•
          cd $TARGET_DIR
          
          # æ¸…ç©ºæ—§æ–‡ä»¶ï¼Œè¿›è¡Œå…¨æ–°éƒ¨ç½²
          echo "ğŸ§¹ Cleaning up old files..."
          sudo rm -rf ./*
          
          # ä» GitHub Actions çš„å·¥ä½œåŒºå¤åˆ¶æ‰€æœ‰æ–°æ–‡ä»¶åˆ°æœåŠ¡å™¨
          echo "ğŸ“‚ Copying new files..."
          sudo cp -r ${{ github.workspace }}/* .
          
          # å°†æ–‡ä»¶æ‰€æœ‰æƒèµ‹äºˆ Nginx è¿è¡Œçš„ç”¨æˆ· (é€šå¸¸æ˜¯ www-data)
          echo "ğŸ” Setting permissions..."
          sudo chown -R www-data:www-data $TARGET_DIR
          
          echo "âœ… Deployment successful!"
